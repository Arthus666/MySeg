import{N as Niivue}from"./niivue.es-963f498d.js";import{a as ref,o as onMounted,u as useRoute,g as getDirInfoById,b as updateUseLog,c as getFileDetailById,d as openBlock,h as createElementBlock,q as createBaseVNode}from"./index-1e170dd9.js";const _hoisted_1={style:{height:"100vh","overflow-y":"hidden"}},_hoisted_2=createBaseVNode("canvas",{id:"gl"},null,-1),_hoisted_3=[_hoisted_2],_sfc_main={__name:"NiiAnalyse",setup(__props){const file_url=ref(""),nv1=new Niivue({dragAndDropEnabled:!0,backColor:[1,.5,1,1],show3Dcrosshair:!0}),initNiiVue=()=>{try{nv1.attachTo("gl"),nv1.setClipPlane([-.1,270,0]),nv1.loadVolumes([{url:file_url.value,opacity:1,visible:!0}]),nv1.setSliceType(nv1.sliceTypeRender),nv1.loadDrawingFromUrl(file_url.value);const text=localStorage.getItem("script_text");console.log(text),text&&eval(text)}catch(t){console.log(t)}},user_token=localStorage.getItem("user_token");return onMounted(()=>{const t=useRoute(),o=JSON.parse(t.query.info);o.type==="cloud"?getDirInfoById(o.id,{user_token}).then(e=>{if(e.code==="200"){const l=e.data.File.filePath.split("\\").splice(2).join("/");file_url.value="./api/"+l,updateUseLog("analyse",e.data.File.fileId,{user_token}).then(a=>{console.log("更新记录",a,"analyse")}),initNiiVue(),console.log("文件路径：",file_url.value)}else console.error(e)}):o.type==="local"&&getFileDetailById(o.id,{user_token}).then(e=>{if(console.log("本地上传"),e.code==="200"){const l=e.data.filePath.split("\\").splice(2).join("/");file_url.value="./api/"+l,updateUseLog("analyse",o.id,{user_token}).then(a=>{console.log("更新记录",a,"analyse")}),initNiiVue(),console.log("文件路径：",file_url.value)}else console.error(e)})}),(t,o)=>(openBlock(),createElementBlock("div",_hoisted_1,_hoisted_3))}};export{_sfc_main as default};
